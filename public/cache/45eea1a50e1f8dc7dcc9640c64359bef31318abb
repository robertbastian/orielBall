{"content":"var guestNumber=0,type,handler=StripeCheckout.configure({key:STRIPE,currency:\"gbp\",image:\"https://www.orielball.uk/images/apple-touch-icon.png\",allowRememberMe:!1,token:function(e){adjustGuests()&&($(\"#payment-form\").get(0).submit(),$(\"#payment-form\").append($('<input type=\"hidden\" name=\"guests\" />').val(guestNumber)),$(\"#payment-form\").append($('<input type=\"hidden\" name=\"stripeToken\" />').val(e.id)))},closed:function(){btn.button(\"reset\")}});$(document).ready(function(){$(\"#bodcardHelp\").tooltip({placement:\"top\",title:\"This is the seven-digit number above the barcode\",container:\"body\"}),$(\"#college select\").selectize({maxItems:1,sortField:{field:\"text\",direction:\"asc\"}}),$(\"#pay\").click(function(){return verifyInput()&&($(this).button(\"loading\"),handler.open({email:$(\"#email input\").val(),name:$(\"#name input\").val(),description:1+guestNumber+\" \"+type.toLowerCase()+\" ticket\"+(guestNumber>0?\"s\":\"\"),amount:100*PRICES[type]*(1+guestNumber)})),!1}),$(\"#addGuest\").click(function(){return moreGuestsAllowed()&&(guestNumber++,$(\"#guestList\").append($('<div class=\"form-group\"><div class=\"input-group\"><span class=\"input-group-addon\"><i class=\"fa fa-user fa-fw\"></i></span><input name=\"guestNames['+guestNumber+']\" type=\"text\" placeholder=\"Name\" class=\"form-control\"><span class=\"input-group-btn\"><button class=\"btn btn-default\" id=\"removeGuest'+guestNumber+'\" type=\"button\"><i class=\"fa fa-minus\"></i></button></span></div><div class=\"input-group\"><span class=\"input-group-addon\"><i class=\"fa fa-at fa-fw\"></i></span><input name=\"guestEmails['+guestNumber+']\" type=\"email\" placeholder=\"Email address\" class=\"form-control\"></div></div>')),$(\"#removeGuest\"+guestNumber).click(function(){return $(this).parent().parent().parent().remove(),guestNumber--,!1})),!1}),$(\"#type label\").change(function(){type=$(\"input[name=type]:checked\").val(),adjustGuests()}),$(\"#nonDiningToggle\").click(),updateTickets()});var moreGuestsAllowed=function(){if(guestNumber+1==MAX_GUEST_NUMBER){var e=$('<div class=\"alert alert-danger\">You can only buy a maximum of '+MAX_GUEST_NUMBER+' tickets <button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button></div>');e.alert(),e.appendTo($(\"#errorBox\"))}else{if(!(1+guestNumber>=remaining[type]))return!0;var e=$('<div class=\"alert alert-danger\">There are not enough tickets of this type left <button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button></div>');e.alert(),e.appendTo($(\"#errorBox\"))}return!1},verifyInput=function(){$(\".has-error\").removeClass(\"has-error\"),/^.+ .+$/.test($(\"#name input\").val())||$(\"#name\").addClass(\"has-error\"),/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9_.+-]+\\.ox\\.ac\\.uk$/.test($(\"#email input\").val())||$(\"#email\").addClass(\"has-error\"),/^[0-9]{7}$/.test($(\"#bodcard input\").val())||$(\"#bodcard\").addClass(\"has-error\");var e=$(\"#college select\").val();\"\"==e&&$(\"#college\").addClass(\"has-error\");var t={\"All Souls\":\"all-souls\",Balliol:\"balliol\",Blackfriars:\"bfriars\",Brasenose:\"bnc\",\"Campion Hall\":\"campion\",\"Christ Church\":\"chch\",\"Corpus Christi\":\"ccc\",Exeter:\"exeter\",\"Green Templeton\":\"gtc\",\"Harris Manchester\":\"hmc\",Hertford:\"hertford\",Jesus:\"jesus\",Keble:\"keble\",Kellogg:\"kellog\",\"Lady Margaret Hall\":\"\",Linacre:\"linacre\",Lincoln:\"lincoln\",Magdalen:\"magd\",Mansfield:\"mansfield\",Merton:\"merton\",New:\"new\",Nuffield:\"nuffield\",Oriel:\"oriel\",Pembroke:\"pmb\",\"Queen's\":\"queens\",\"Regent's Park\":\"regents\",Somerville:\"some\",\"St Anne's\":\"st-annes\",\"St Antony's\":\"sant\",\"St Benet's Hall\":\"stb\",\"St Catherine's\":\"stcatz\",\"St Cross\":\"stx\",\"St Edmund Hall\":\"seh\",\"St Hilda's\":\"sthildas\",\"St Hugh's\":\"st-hughs\",\"St John's\":\"sjc\",\"St Peter's\":\"spc\",\"St Stephen's House\":\"ssho\",Trinity:\"trinity\",University:\"univ\",Wadham:\"wadh\",Wolfson:\"wolfson\",Worcester:\"worc\",\"Wycliffe Hall\":\"wycliffe\",\"\":\"\"};if(new RegExp(\"@\"+t[e]+\".ox.ac.uk\".test(email))){if(\"Oriel\"!=e&&ORIEL_ONLY){var n=$('<div class=\"alert alert-danger\">Booking is only open to Oriel members at the moment!<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button></div>');n.alert(),n.appendTo($(\"#errorBox\"))}}else{var n=$('<div class=\"alert alert-danger\">Your college doesn\\'t match your email!<button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button></div>');n.alert(),n.appendTo($(\"#errorBox\"))}return 0==$(\".has-error\").length},adjustGuests=function(){var e=$(\"#guestList .form-group\").length+1-remaining[type];if(e>0){for(var t=0;e>t;t++)$(\"#guestList .form-group:last\").remove(),guestNumber--;var n=$('<div class=\"alert alert-danger\">'+e+' of your guests had to be removed, because there aren\\'t enough tickets left. <button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button></div>');return n.alert(),n.appendTo($(\"#errorBox\")),!1}return!0},adjustButtons=function(){if(0==remaining[\"Non-dining\"]&&\"Non-dining\"==type||0==remaining.Dining&&\"Dining\"==type){var e=$('<div class=\"alert alert-danger\">Your ticket type was changed because '+type.toLowerCase()+' tickets just sold out. <button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span aria-hidden=\"true\">&times;</span><span class=\"sr-only\">Close</span></button></div>');e.alert(),e.appendTo($(\"#errorBox\"))}0==remaining[\"Non-dining\"]?($(\"#nonDiningToggle\").addClass(\"disabled\"),$(\"#diningToggle\").click()):0==remaining.Dining&&($(\"#diningToggle\").addClass(\"disabled\"),$(\"#nonDiningToggle\").click())},updateTickets=function(){$.post(\"/ticketsLeft\").done(function(e){remaining={\"Non-dining\":e[0],Dining:e[1]},remaining[\"Non-dining\"]+remaining.Dining==0&&location.reload(),adjustButtons(),adjustGuests(),$(\"#nonDiningLeft\").html(\"&nbsp;\"+remaining[\"Non-dining\"]),$(\"#diningLeft\").html(\"&nbsp;\"+remaining.Dining),setTimeout(updateTickets,1e4)}).fail(function(){setTimeout(updateTickets,3e4)})};"}